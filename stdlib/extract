TMP=~tmp.s
IN=obj/local/arm64-v8a/stdlib
OUT=stdlib.s

../disass --static $IN \
  @memset @memcpy @sin @cos @sqrt @pow \
  __kernel_sin __kernel_cos __kernel_rem_pio2 scalbn \
  > $TMP

cat > $OUT << EOF
	.text
	.global s_memset
	.global s_memcpy
	.global s_sin
	.global s_cos
	.global s_sqrt
	.global s_pow
	.align 3
EOF

python ../refine.py $TMP >> $OUT

replace() {
  if [[ `uname -s` == Darwin ]]; then
    sed -i '' "/^$2/s/$3/$4/" $1
  else
    sed -i "/^$2/s/$3/$4/" $1
  fi
}

python ../post.py $OUT

replace $OUT memset: memset s_memset
replace $OUT memcpy: memcpy s_memcpy
replace $OUT sin: sin s_sin
replace $OUT cos: cos s_cos
replace $OUT sqrt: sqrt s_sqrt
replace $OUT pow: pow s_pow

rm $TMP
